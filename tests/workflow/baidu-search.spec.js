/**
 * ============================================================
 * æµ‹è¯•æ–‡ä»¶: MVP ç«¯åˆ°ç«¯éªŒè¯ - ç™¾åº¦æœç´¢å·¥ä½œæµ
 * ============================================================
 *
 * åŠŸèƒ½æè¿°:
 *   é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„ç™¾åº¦æœç´¢åœºæ™¯ï¼Œç«¯åˆ°ç«¯éªŒè¯ MVP çš„ä¸‰å±‚æž¶æž„ï¼š
 *   1. LLM å°†è‡ªç„¶è¯­è¨€è§£æžä¸ºæŒ‡ä»¤æµ
 *   2. é€‚é…å™¨ä½¿ç”¨ Zerostep AI + Playwright æ··åˆç­–ç•¥æ‰§è¡ŒæŒ‡ä»¤
 *   3. éªŒè¯æœç´¢ç»“æžœ
 *
 * è¦†ç›–åœºæ™¯:
 *   - navigate: é¡µé¢å¯¼èˆª
 *   - input: è¾“å…¥æ–‡æœ¬ (AI å®šä½)
 *   - click: ç‚¹å‡»æŒ‰é’® (AI å®šä½)
 *   - wait: ç­‰å¾…é¡µé¢åŠ è½½
 *   - verify: éªŒè¯é¡µé¢å†…å®¹ (AI æ–­è¨€)
 * ============================================================
 */

import { test } from '../../utils/fixture.js'
import { expect } from '@playwright/test'
import { runWorkflow } from '../../api/workflow.js'

/**
 * æµ‹è¯•ç”¨ä¾‹ 1: ç™¾åº¦æœç´¢ - å…¨æµç¨‹ AI é©±åŠ¨
 *
 * å®Œæ•´å·¥ä½œæµ:
 * ç”¨æˆ·è¾“å…¥è‡ªç„¶è¯­è¨€ -> LLM è§£æž -> é€‚é…å™¨æ‰§è¡Œ -> éªŒè¯ç»“æžœ
 */
test('MVPéªŒè¯: ç™¾åº¦æœç´¢ Playwright', async ({ page, ai }) => {
  // è®¾ç½®æ›´é•¿çš„æµ‹è¯•è¶…æ—¶æ—¶é—´ï¼Œå› ä¸ºæ¶‰åŠ LLM è°ƒç”¨å’Œ AI æ“ä½œ
  test.setTimeout(180_000)

  const result = await runWorkflow(
    'æ‰“å¼€ç™¾åº¦é¦–é¡µ (https://www.baidu.com)ï¼Œåœ¨æœç´¢æ¡†ä¸­è¾“å…¥ "Playwright"ï¼Œç„¶åŽç‚¹å‡»"ç™¾åº¦ä¸€ä¸‹"æœç´¢æŒ‰é’®ï¼Œç­‰å¾…æœç´¢ç»“æžœåŠ è½½å®Œæˆï¼ŒéªŒè¯æœç´¢ç»“æžœé¡µé¢ä¸­åŒ…å« "Playwright" ç›¸å…³å†…å®¹',
    { page, ai },
    { stopOnError: true, stepDelay: 0 },
  )

  // æ–­è¨€: å·¥ä½œæµæ‰§è¡ŒæˆåŠŸ
  console.log('\nðŸ“Š å·¥ä½œæµæ‰§è¡Œç»“æžœ:', JSON.stringify(result.summary, null, 2))

  if (!result.summary.allPassed) {
    console.log('\nâŒ å¤±è´¥çš„æ­¥éª¤:')
    result.results
      .filter(r => !r.success)
      .forEach(r => console.log(`  - æ­¥éª¤ ${r.step_id}: ${r.description} -> ${r.error}`))
  }

  // æ–­è¨€: æ‰€æœ‰æ­¥éª¤å¿…é¡»é€šè¿‡
  expect(result.summary.allPassed).toBe(true)
})
