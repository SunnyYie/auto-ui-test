# Auto UI Test - AI é©±åŠ¨çš„ Web UI è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶

> åŸºäº LLM + Playwright + Zerostep çš„ä¸‰å±‚æ¶æ„ï¼Œç”¨è‡ªç„¶è¯­è¨€æè¿°æµ‹è¯•æ„å›¾ï¼Œè‡ªåŠ¨å®Œæˆ Web UI æ“ä½œä¸éªŒè¯ã€‚

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ª AI é©±åŠ¨çš„ Web UI è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ã€‚ç”¨æˆ·åªéœ€è¾“å…¥è‡ªç„¶è¯­è¨€ï¼ˆå¦‚ "æ‰“å¼€ç™¾åº¦æœç´¢ Playwright å¹¶éªŒè¯ç»“æœ"ï¼‰ï¼Œç³»ç»Ÿå³å¯è‡ªåŠ¨ï¼š

1. **LLM è§£æ** â€” å°†è‡ªç„¶è¯­è¨€è½¬åŒ–ä¸ºæ ‡å‡†åŒ–çš„æŒ‡ä»¤æµ JSON
2. **æ™ºèƒ½æ‰§è¡Œ** â€” é€šè¿‡æ··åˆç­–ç•¥ï¼ˆPlaywright ä¼˜å…ˆ + AI å…œåº•ï¼‰æ‰§è¡ŒæŒ‡ä»¤
3. **ç»“æœéªŒè¯** â€” è‡ªåŠ¨éªŒè¯é¡µé¢å†…å®¹æ˜¯å¦ç¬¦åˆé¢„æœŸ

### æ ¸å¿ƒç‰¹æ€§

- ğŸ§  **LLM é©±åŠ¨** â€” è‡ªç„¶è¯­è¨€ â†’ ç»“æ„åŒ–æŒ‡ä»¤ï¼Œæ— éœ€æ‰‹å†™æµ‹è¯•è„šæœ¬
- âš¡ **æ··åˆç­–ç•¥** â€” Playwright åŸç”Ÿæ“ä½œä¼˜å…ˆï¼ˆæ¯«ç§’çº§ï¼‰ï¼ŒZerostep AI å…œåº•ï¼ˆç§’çº§ï¼‰
- ğŸ’¾ **æŒ‡ä»¤ç¼“å­˜** â€” é¦–æ¬¡è§£æåç¼“å­˜æŒ‡ä»¤æµï¼Œåç»­è¿è¡Œè·³è¿‡ LLM è°ƒç”¨
- ğŸš€ **å¹¶è¡Œä¼˜åŒ–** â€” LLM è§£æä¸é¡µé¢å¯¼èˆªå¹¶è¡Œæ‰§è¡Œï¼ŒèŠ‚çœç­‰å¾…æ—¶é—´
- ğŸ”„ **DOM å¼ºåˆ¶æ“ä½œ** â€” å¯¹éšè—å…ƒç´ ä½¿ç”¨ JS ç›´æ¥æ“ä½œ DOMï¼Œç»•è¿‡å¯è§æ€§é™åˆ¶

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥     â”‚ â”€â”€â–¶ â”‚  LLM Planner     â”‚ â”€â”€â–¶ â”‚  Hybrid Adapter  â”‚ â”€â”€â–¶ â”‚ Browser  â”‚
â”‚  (è‡ªç„¶è¯­è¨€)   â”‚     â”‚  (è§£æä¸è§„åˆ’å±‚)    â”‚     â”‚  (é€‚é…å±‚)         â”‚     â”‚ (æ‰§è¡Œå±‚)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚                        â”‚
                    api/llm-client.js         api/adapter.js
                    api/schema.js             Playwright + Zerostep
```

### æ¨¡å—è¯´æ˜

| æ¨¡å—            | æ–‡ä»¶                | èŒè´£                                  |
| --------------- | ------------------- | ------------------------------------- |
| ç»Ÿä¸€æŒ‡ä»¤ Schema | `api/schema.js`     | å®šä¹‰ 9 ç§ action_type åŠå‚æ•°æ ¡éªŒè§„åˆ™  |
| LLM å®¢æˆ·ç«¯      | `api/llm-client.js` | è°ƒç”¨å¤§æ¨¡å‹ï¼Œå°†è‡ªç„¶è¯­è¨€è½¬ä¸ºæŒ‡ä»¤æµ JSON |
| æ··åˆé€‚é…å™¨      | `api/adapter.js`    | æ ¸å¿ƒæ‰§è¡Œå±‚ï¼ŒPlaywright ä¼˜å…ˆ + AI å…œåº• |
| å·¥ä½œæµå¼•æ“      | `api/workflow.js`   | ç¼–æ’å™¨ï¼Œä¸²è” LLM â†’ é€‚é…å™¨ â†’ æµè§ˆå™¨    |
| æµ‹è¯• Fixture    | `utils/fixture.js`  | Playwright + Zerostep + Stealth é›†æˆ  |

### æ”¯æŒçš„æŒ‡ä»¤ç±»å‹

`navigate` Â· `click` Â· `input` Â· `verify` Â· `wait` Â· `select` Â· `hover` Â· `press` Â· `scroll`

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18
- pnpm >= 8

### å®‰è£…ä¾èµ–

```bash
pnpm install
npx playwright install chromium
```

### é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```bash
# LLM API é…ç½®ï¼ˆAnthropic å…¼å®¹æ¥å£ï¼‰
ANTHROPIC_BASE_URL=https://your-llm-api-proxy.com/api
ANTHROPIC_AUTH_TOKEN=your_auth_token

# Zerostep Token (ä¹Ÿéœ€é…ç½® zerostep.config.json)
ZEROSTEP_TOKEN=your_zerostep_token
```

åˆ›å»º `zerostep.config.json` æ–‡ä»¶ï¼š

```json
{
  "TOKEN": "your_zerostep_token"
}
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œ AI å·¥ä½œæµæµ‹è¯•ï¼ˆå¸¦æµè§ˆå™¨ç•Œé¢ï¼‰
pnpm test:workflow

# é¦–æ¬¡è¿è¡Œï¼ˆæ¸…é™¤ç¼“å­˜ï¼Œå®Œæ•´ LLM è§£æ + æ‰§è¡Œï¼‰
pnpm test:fresh

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# å¸¦æµè§ˆå™¨ç•Œé¢è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test:headed

# è°ƒè¯•æ¨¡å¼ï¼ˆPlaywright Inspectorï¼‰
pnpm test:debug

# Playwright UI æ¨¡å¼
pnpm test:ui
```

## ğŸ“‹ è„šæœ¬å‘½ä»¤

| å‘½ä»¤                 | è¯´æ˜                                     |
| -------------------- | ---------------------------------------- |
| `pnpm test`          | è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆæ— å¤´æ¨¡å¼ï¼‰                 |
| `pnpm test:ui`       | Playwright UI å¯è§†åŒ–æ¨¡å¼                 |
| `pnpm test:headed`   | å¸¦æµè§ˆå™¨ç•Œé¢è¿è¡Œæ‰€æœ‰æµ‹è¯•                 |
| `pnpm test:workflow` | è¿è¡Œ AI å·¥ä½œæµæµ‹è¯•ï¼ˆå¸¦æµè§ˆå™¨ç•Œé¢ï¼‰       |
| `pnpm test:debug`    | è°ƒè¯•æ¨¡å¼ï¼Œå¯åŠ¨ Playwright Inspector      |
| `pnpm test:login`    | è¿è¡Œç™»å½•ç›¸å…³æµ‹è¯•                         |
| `pnpm test:search`   | è¿è¡Œæœç´¢ç›¸å…³æµ‹è¯•                         |
| `pnpm clean:cache`   | æ¸…é™¤ LLM æŒ‡ä»¤æµç¼“å­˜                      |
| `pnpm test:fresh`    | æ¸…é™¤ç¼“å­˜åè¿è¡Œå·¥ä½œæµæµ‹è¯•ï¼ˆå¼ºåˆ¶é‡æ–°è§£æï¼‰ |

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ä¼˜åŒ–ç­–ç•¥

1. **æŒ‡ä»¤ç¼“å­˜** â€” LLM è§£æç»“æœç¼“å­˜åˆ° `.cache/` ç›®å½•ï¼Œç›¸åŒ prompt ä¸é‡å¤è°ƒç”¨ LLM
2. **å¹¶è¡Œå¯¼èˆª** â€” é¦–æ¬¡è¿è¡Œæ—¶ï¼ŒLLM è§£æä¸é¡µé¢å¯¼èˆªå¹¶è¡Œæ‰§è¡Œ
3. **Playwright ä¼˜å…ˆ** â€” æœ‰ CSS é€‰æ‹©å™¨æ—¶ä¼˜å…ˆç”¨ Playwrightï¼ˆæ¯«ç§’çº§ï¼‰ï¼Œæ— é€‰æ‹©å™¨æˆ–å¤±è´¥æ—¶æ‰è°ƒç”¨ AIï¼ˆç§’çº§ï¼‰
4. **DOM å¼ºåˆ¶æ“ä½œ** â€” å¯¹ç™¾åº¦ç­‰å­˜åœ¨éšè—å…ƒç´ çš„ç½‘ç«™ï¼Œç”¨ `page.evaluate()` + `dispatchEvent` ç›´æ¥æ“ä½œ DOM
5. **å…³é”®è¯æå–** â€” éªŒè¯æ­¥éª¤å…ˆä»æ–­è¨€æ–‡æœ¬ä¸­æå–å…³é”®è¯ï¼Œç”¨ Playwright åŸç”Ÿæ£€æµ‹ï¼ˆ50msï¼‰ï¼Œé¿å… AI è°ƒç”¨ï¼ˆ5s+ï¼‰
6. **ç²¾ç®€ç­‰å¾…** â€” wait è¶…æ—¶æ—¶å¿«é€Ÿå›é€€åˆ° `domcontentloaded`ï¼Œä¸ä½¿ç”¨æ…¢é€Ÿçš„ `networkidle`

### æ€§èƒ½æ•°æ®

| è¿è¡Œæ¨¡å¼                   | è€—æ—¶     | è¯´æ˜                                     |
| -------------------------- | -------- | ---------------------------------------- |
| ç¼“å­˜æ¨¡å¼ï¼ˆå¸¸è§„è¿è¡Œï¼‰       | **4-6s** | è·³è¿‡ LLMï¼Œç›´æ¥æ‰§è¡Œç¼“å­˜çš„æŒ‡ä»¤æµ           |
| é¦–æ¬¡è¿è¡Œï¼ˆLLM + å¹¶è¡Œå¯¼èˆªï¼‰ | **7-9s** | LLM è§£æä¸é¡µé¢å¯¼èˆªåŒæ—¶è¿›è¡Œ               |
| ä¼˜åŒ–å‰åŸºå‡†                 | ~30s     | Zerostep AI è°ƒç”¨ 12s + LLM 5s + å¯¼èˆªç­‰å¾… |

## ğŸ“ é¡¹ç›®ç»“æ„

```
auto-ui-test/
â”œâ”€â”€ api/                     # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ schema.js            # ç»Ÿä¸€æŒ‡ä»¤ Schema å®šä¹‰ä¸æ ¡éªŒ
â”‚   â”œâ”€â”€ llm-client.js        # LLM å®¢æˆ·ç«¯ (è‡ªç„¶è¯­è¨€ â†’ æŒ‡ä»¤æµ)
â”‚   â”œâ”€â”€ adapter.js           # æ··åˆç­–ç•¥é€‚é…å™¨ (Playwright + AI)
â”‚   â””â”€â”€ workflow.js          # å·¥ä½œæµå¼•æ“ (ç¼–æ’å™¨)
â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ workflow/            # AI å·¥ä½œæµç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â”‚   â””â”€â”€ baidu-search.spec.js
â”‚   â”œâ”€â”€ login/               # ç™»å½•æµ‹è¯•
â”‚   â””â”€â”€ search/              # æœç´¢æµ‹è¯•
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ fixture.js           # Playwright + Zerostep Fixture
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â”‚   â”œâ”€â”€ æ¶æ„è®¾è®¡.md           # è¯¦ç»†æ¶æ„è®¾è®¡æ–‡æ¡£
â”‚   â””â”€â”€ MVPéªŒè¯è®°å½•.md        # MVP éªŒè¯è¿‡ç¨‹è®°å½•
â”œâ”€â”€ .cache/                  # LLM æŒ‡ä»¤æµç¼“å­˜ (gitignore)
â”œâ”€â”€ .env.local               # ç¯å¢ƒå˜é‡ (gitignore)
â”œâ”€â”€ playwright.config.js     # Playwright é…ç½®
â”œâ”€â”€ zerostep.config.json     # Zerostep é…ç½® (gitignore)
â””â”€â”€ package.json
```

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹

åœ¨ Playwright æµ‹è¯•ä¸­ä½¿ç”¨å·¥ä½œæµå¼•æ“ï¼š

```javascript
import { test } from '../utils/fixture.js'
import { expect } from '@playwright/test'
import { runWorkflow } from '../api/workflow.js'

test('AI é©±åŠ¨çš„ç™¾åº¦æœç´¢', async ({ page, ai }) => {
  test.setTimeout(180_000)

  const result = await runWorkflow(
    'æ‰“å¼€ç™¾åº¦é¦–é¡µï¼Œæœç´¢ "Playwright"ï¼ŒéªŒè¯æœç´¢ç»“æœåŒ…å«ç›¸å…³å†…å®¹',
    { page, ai },
    { stopOnError: true, stepDelay: 0 },
  )

  expect(result.summary.allPassed).toBe(true)
})
```

### å·¥ä½œæµé€‰é¡¹

| é€‰é¡¹          | ç±»å‹    | é»˜è®¤å€¼ | è¯´æ˜               |
| ------------- | ------- | ------ | ------------------ |
| `stopOnError` | boolean | true   | æ­¥éª¤å¤±è´¥æ—¶æ˜¯å¦åœæ­¢ |
| `stepDelay`   | number  | 0      | æ­¥éª¤é—´å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ |
| `useCache`    | boolean | true   | æ˜¯å¦ä½¿ç”¨æŒ‡ä»¤æµç¼“å­˜ |

## ğŸ“„ License

ISC
